<actions version="0.0">
  
  <action>
    <id>upload-data-image</id>
    <parameters>
      <upload-image><!-- uploads an image from the local filesystem to your 
        OpenStack project -->
        <file-name>./data-image.vmdk</file-name><!-- name of the image file on 
          your local filesystem -->
        <image-name>data-image</image-name><!-- name of the newly uploaded 
          image. There can not already be an image with this name.-->
      </upload-image>
    </parameters>
  </action>
  
  <action>
    <id>upload-root-image</id>
    <parameters>
      <upload-image>
        <file-name>./root-image.vmdk</file-name>
        <image-name>root-image</image-name>
      </upload-image>
    </parameters>
  </action>
  
  <action>
    <id>create-data-volume</id>
    <dependencies>
      <dependency>upload-data-image</dependency>
    </dependencies>
    <parameters>
      <create-volume-from-image><!-- creates a volume from an image -->
        <volume-name>data</volume-name><!-- name of the newly created volume. 
          There can not already be a volume with this name. -->
        <image>data-image</image><!-- name or id of the image to create the 
          volume from -->
        <size>20</size><!-- size of the volume to create in GB. This must be at 
          least as large as the image. -->
      </create-volume-from-image>
    </parameters>
  </action>
  
  <action>
    <id>create-root-volume</id>
    <dependencies>
      <dependency>upload-root-image</dependency>
    </dependencies>
    <parameters>
      <create-volume-from-image>
        <volume-name>root</volume-name>
        <image>root-image</image>
        <size>20</size>
      </create-volume-from-image>
    </parameters>
  </action>
  

  <!--Setup vm, same as when creating the backup-->
  <action>
    <id>vm-create</id>
    <dependencies>
      <dependency>create-root-volume</dependency>
      <dependency>create-data-volume</dependency>
    </dependencies>
    <parameters>
      <create-instance>
        <name>test-backup</name>
        <flavor>c4-15gb-205</flavor>
        <instance-boot-source>
          <volume>root</volume>
        </instance-boot-source>
      </create-instance>
    </parameters>
  </action>
  
  <action>
    <id>add-ip</id>
    <dependencies>
      <dependency>vm-create</dependency>
    </dependencies>
    <parameters>
      <associate-floating-ip>
        <instance>test-backup</instance>
        <ip>206.167.123.123</ip>
      </associate-floating-ip>
    </parameters>
  </action>
  
  <action>
    <id>attach-data-disk</id>
    <dependencies>
      <dependency>vm-create</dependency>
    </dependencies>
    <parameters>
      <attach-volume>
        <instance>test-backup</instance>
        <volume>data</volume>
        <device>/dev/vdc</device>
      </attach-volume>
    </parameters>
  </action>
  
</actions>
